<%!
    import scatterbrainz.controllers.renderer as r
%>

<html>
<head>
<script type="text/javascript" src="/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="/jquery.tablesorter.js"></script>
<script type="text/javascript" src="/jquery-ui-1.8rc3.custom.min.js"></script>
<link rel="stylesheet" type="text/css" href="/jplayer.blue.monday.css" />
<link rel="stylesheet" type="text/css" href="/scatterbrainz.css" />
<link rel="stylesheet" type="text/css" href="/jquery-ui-1.8rc3.custom.css" />
</head>

<body>

<div id="browser">
<li>artist1 artist1 artist1 artist1 artist1 artist1 artist1 artist1 artist1 artist1 artist1 </li>
<li>artist2</li>
<li>artist3</li>
<li>artist4</li>
<li>artist5</li>
<li>artist6</li>
</div>

<div id="jquery_jplayer"></div>
    <div class="jp-playlist-player">
        <div class="jp-playlist">
            <table id="playlist" border="0" cellspacing="0" cellpadding="0">
              <thead class="playlistHead">
                <tr class="playlistHeadRow">
                  <th class='artist'>Artist</th>
                  <th class='title'>Title</th>
                  <th class='album'>Album</th>
                  <th class='track'>Track</th>
                  <th class='length'>Length</th>
                  <th class='bitrate'>Bitrate</th>
                </tr>
              </thead>
              <tbody id="playlistbody" style="overflow-x: hidden; overflow-y: auto; height: 600px; display: block; padding: 0px; ">
                % for track in c.tracks:
                    <tr style="width: 870px;" class="song" href="/.music/${r.getFullPath(track)}">
                      <td class='artist'>${r.artist(track)}</td>
                      <td class='title'>${r.title(track)}</td>
                      <td class='album'>${r.album(track)}</td>
                      <td class='track'>${r.tracknum(track)}</td>
                      <td class='length'>${r.length(track)}</td>
                      <td class='bitrate'>${r.bitrate(track)}</td>
                    </tr>
                % endfor
              </tbody>
            </table>
        </div> 
        <div class="jp-interface">
            <ul class="jp-controls"> 
                <li id="jplayer_play" class="jp-play">play</li> 
                <li id="jplayer_pause" class="jp-pause">pause</li> 
                <li id="jplayer_stop" class="jp-stop">stop</li> 
                <li id="jplayer_volume_min" class="jp-volume-min">min volume</li> 
                <li id="jplayer_volume_max" class="jp-volume-max">max volume</li> 
                <li id="jplayer_previous" class="jp-previous">previous</li> 
                <li id="jplayer_next" class="jp-next">next</li> 
            </ul> 
            <div class="jp-progress"> 
                <div id="jplayer_load_bar" class="jp-load-bar"> 
                    <div id="jplayer_play_bar" class="jp-play-bar"></div> 
                </div> 
            </div> 
            <div id="jplayer_volume_bar" class="jp-volume-bar"> 
                <div id="jplayer_volume_bar_value" class="jp-volume-bar-value"></div> 
            </div> 
            <div id="jplayer_play_time" class="jp-play-time"></div> 
            <div id="jplayer_total_time" class="jp-total-time"></div>
        </div>
    </div> 

<script type="text/javascript">

$('#playlist').tablesorter();
$('#playlistbody').sortable({ axis: 'y', opacity: 0.6,
                              containment: 'parent', items: 'tr',
                              placeholder: 'placeholder'});

function playRow(row) {
    $('.playing').removeClass('playing');
    $("#jquery_jplayer").jPlayer("setFile", row.attr('href'))
                        .jPlayer("play");
    row.addClass('playing');
}

function stop() {
    $("#jquery_jplayer").jPlayer("stop");
}
                              
function play() {
    playRow($(this));
}

$(document).ready(function() {
    $("#jquery_jplayer").jPlayer( {
        ready: function () {
            $('.song').dblclick(play);
        }
    });
});

function playlistNextPrev(next) {
    var playing = $('.playing');
    if (playing) {
        playing.removeClass('playing');
        if (next) {
            if (playing.next().hasClass('song')) {
                playing.next().addClass('playing');
                playRow(playing.next());
            } else {
                stop();
            }
        } else {
            if (playing.prev().hasClass('song')) {
                playing.prev().addClass('playing');
                playRow(playing.prev());
            } else {
                stop();
            }
        }
    }
}

function playListPrev() {
    playlistNextPrev(false);
}

function playListNext() {
    playlistNextPrev(true);
}

$(document).ready(function(){

    var jpPlayTime = $("#jplayer_play_time");
    var jpTotalTime = $("#jplayer_total_time");

    $("#jquery_jplayer").jPlayer("onProgressChange", function(loadPercent, playedPercentRelative, playedPercentAbsolute, playedTime, totalTime) {
        jpPlayTime.text($.jPlayer.convertTime(playedTime));
        jpTotalTime.text($.jPlayer.convertTime(totalTime));
    })
    .jPlayer("onSoundComplete", function() {
        playListNext();
    });

    $("#jplayer_previous").click( function() {
        playListPrev();
        return false;
    });

    $("#jplayer_next").click( function() {
        playListNext();
        return false;
    });

});

</script> 

</body>
</html>
